"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1312],{55595:function(e,t,a){var s=a(57437),l=a(76857),n=a(9880),c=a(2265),o=a(94295),i=a(66070),r=a(62869),d=a(32768),x=a(85024),u=a(99376),p=a(85130),m=a(26110);t.Z=e=>{let{payload:t,metadata:a}=e,f=(0,u.useRouter)(),[h,y]=(0,c.useState)(!1),[j,g]=(0,c.useState)(null),[v,N]=(0,c.useState)(null);return((0,c.useEffect)(()=>{g((null==a?void 0:a.collection_name)||""),N((null==a?void 0:a.total_objects)||0)},[a]),t)?(0,s.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,s.jsxs)(r.z,{variant:"ghost",className:"border-secondary text-secondary",size:"sm",onClick:()=>y(!0),children:[(0,s.jsx)(o.YUF,{size:12}),j?(0,s.jsxs)("p",{className:"text-xs font-bold",children:[j,v&&v>0?"(".concat(v,")"):""]}):(0,s.jsx)("p",{className:"text-xs font-bold",children:"Query"})]}),h&&(0,s.jsx)(m.Vq,{open:h,onOpenChange:e=>{e||y(!1)},children:(0,s.jsx)(m.cZ,{children:(0,s.jsxs)(i.Zb,{className:"fixed top-1/2 bg-background left-1/2 transform -translate-x-1/2 -translate-y-1/2 z-50 w-full lg:w-[70vw] overflow-auto",children:[(0,s.jsx)(i.Ol,{children:(0,s.jsx)(i.ll,{children:(0,s.jsxs)("div",{className:"flex justify-between items-center",children:[t.title&&(0,s.jsx)("p",{children:t.title}),(0,s.jsxs)("div",{className:"flex gap-2",children:[j&&(0,s.jsxs)(r.z,{variant:"ghost",size:"sm",className:"text-secondary",onClick:()=>{f.push("/data?collection_id=".concat(j,"&page=1"))},children:[(0,s.jsx)(p.QC3,{size:12}),j]}),(0,s.jsx)(x.Z,{copyText:t.text}),(0,s.jsx)(r.z,{variant:"ghost",size:"icon",onClick:()=>y(!1),children:(0,s.jsx)(d.bjh,{size:12})})]})]})})}),(0,s.jsx)(i.aY,{children:(0,s.jsx)(l.Z,{language:t.language,wrapLongLines:!0,showLineNumbers:!0,style:n.Z,customStyle:{backgroundColor:"#121212",color:"#ffffff",width:"100%",maxHeight:"calc(80vh - 2rem)"},className:"rounded-lg",children:t.text})})]})})})]}):null}},91312:function(e,t,a){a.d(t,{Z:function(){return L}});var s=a(57437),l=a(2265),n=a(85024),c=e=>{let{payload:t,onClick:a,collapsed:c,NER:o,updateNER:i,conversationId:r,queryId:d}=e,[x,u]=(0,l.useState)([]),[p,m]=(0,l.useState)([]),f=t&&t[0];(0,l.useEffect)(()=>{null==o?h(t[0]):(u(o.noun_spans),m(o.entity_spans))},[t]);let h=async e=>{let t=await fetch("/api/get_ner",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({text:e})}),a=await t.json();u(a.noun_spans),m(a.entity_spans),i(r,d,a)};return(0,s.jsx)("div",{className:"flex flex-col rounded-lg transition-all duration-300 justify-start items-start mt-8 cursor-pointer w-full",onClick:a,children:(0,s.jsx)("div",{className:"w-full",children:(0,s.jsx)("div",{className:"flex font-heading flex-grow justify-start items-start chat-animation gap-4",children:c?(0,s.jsx)("p",{className:"text-secondary hover:text-primary text-xl transition-all duration-300 text-left",children:f}):(0,s.jsxs)("div",{className:"flex gap-3 items-center",children:[(0,s.jsx)("p",{className:"text-primary text-3xl text-left flex-grow",children:(e=>{if(!e||0===x.length&&0===p.length)return e;let t=[...x.map(e=>{let[t,a]=e;return{start:t,end:a,type:"noun"}}),...p.map(e=>{let[t,a]=e;return{start:t,end:a,type:"entity"}})],a=[];t.forEach(e=>{a.push({index:e.start,type:e.type,isStart:!0}),a.push({index:e.end,type:e.type,isStart:!1})}),a.sort((e,t)=>e.index-t.index||(e.isStart?-1:1));let l=[],n=0,c=new Set;if(a.forEach(t=>{if(t.index>n){let a=e.slice(n,t.index),o="";c.has("noun")&&(o="font-bold text-highlight "),c.has("entity")&&(o="text-accent font-bold  "),l.push((0,s.jsx)("span",{className:o,children:a},"segment-".concat(n,"-").concat(t.index)))}t.isStart?c.add(t.type):c.delete(t.type),n=t.index}),n<e.length){let t="";c.has("noun")&&(t="font-bold text-highlight "),c.has("entity")&&(t="text-accent font-bold "),l.push((0,s.jsx)("span",{className:t,children:e.slice(n)},"segment-".concat(n,"-end")))}return l})(f)}),(0,s.jsx)(n.Z,{copyText:f})]})})})})},o=a(74100),i=a(32768),r=e=>{let{error:t}=e;return(0,s.jsx)("div",{className:"w-full flex flex-col justify-start items-start ",children:(0,s.jsx)("div",{className:"max-w-3/5",children:(0,s.jsxs)("div",{className:"flex flex-col justify-start items-start gap-2 chat-animation border border-error p-4 rounded-lg",children:[(0,s.jsxs)("div",{className:"flex gap-2 items-center",children:[(0,s.jsx)(i.SZZ,{className:"text-error text-lg"}),(0,s.jsx)("p",{className:"text-error text-sm font-bold",children:"Error"})]}),(0,s.jsx)(o.Z,{text:t})]})})})},d=e=>{let{payload:t}=e,[a,n]=(0,l.useState)(!0);return(0,s.jsxs)("div",{className:"w-full flex flex-col items-start justify-start gap-3",children:[t.length>1&&!a&&(0,s.jsx)("div",{className:"flex flex-col gap-2",children:t.slice(0,-1).map((e,t)=>(0,s.jsxs)("div",{className:"flex gap-2 items-center justify-center fade-in",children:[(0,s.jsx)("p",{className:"text-xs w-5 h-5 bg-background_alt text-secondary p-2 rounded-full items-center justify-center flex",children:t+1},"".concat(e.text,"-").concat(t)),(0,s.jsx)(o.Z,{text:e.text,variant:"secondary"})]},"".concat(e.text,"-").concat(t)))}),t.length>0&&(0,s.jsxs)("div",{className:"fade-in flex w-full gap-2 items-center cursor-pointer",onClick:()=>{n(e=>!e)},children:[t.length>1&&(0,s.jsx)("p",{className:"text-xs bg-background_alt text-secondary p-2 w-5 h-5 rounded-full items-center justify-center flex",children:t.length}),(0,s.jsx)(o.Z,{text:t[t.length-1].text})]},t[t.length-1].text)]})},x=a(60189),u=e=>{let{warning:t}=e;return(0,s.jsx)("div",{className:"w-full flex flex-col justify-start items-start ",children:(0,s.jsxs)("div",{className:"flex flex-col justify-start items-start gap-2 chat-animation border border-warning p-4 rounded-lg",children:[(0,s.jsxs)("div",{className:"flex gap-2 items-center",children:[(0,s.jsx)(i.SZZ,{className:"text-warning text-lg"}),(0,s.jsx)("p",{className:"text-warning text-sm font-bold",children:"Warning"})]}),(0,s.jsx)(o.Z,{text:t})]})})},p=e=>{let{payload:t}=e;return(0,s.jsx)("div",{className:"w-full mt-5 flex chat-animation flex-col justify-start items-start bg-background_alt p-4 rounded-lg border border-secondary",children:t.map((e,t)=>(0,s.jsxs)("div",{className:"text-sm text-white flex flex-col gap-1",children:[(0,s.jsx)("p",{className:"font-bold font-heading text-lg text-white",children:e.title}),(0,s.jsx)(o.Z,{text:e.text})]},t))})},m=a(9452),f=a(21994),h=e=>{let{payload:t}=e;return(0,s.jsx)("div",{className:"w-full flex flex-col justify-start items-start max-h-[30vh] overflow-y-auto",children:(0,s.jsx)(f.Z,{data:t,header:Object.keys(t[0]),setSelectedCell:()=>{}})})},y=a(55595),j=a(16127),g=e=>{let{_text:t}=e,a=t||"",[n,c]=(0,l.useState)(a&&a.length>500);return(0,s.jsxs)("div",{className:"w-full flex flex-col gap-2 items-center justify-center",children:[(0,s.jsx)(o.Z,{text:n?a.slice(0,500):a}),a.length>500&&(0,s.jsx)(s.Fragment,{children:n?(0,s.jsx)("button",{className:"btn",onClick:()=>c(e=>!e),children:(0,s.jsx)("p",{className:"text-xs text-secondary",children:"Show more"})}):(0,s.jsx)("button",{className:"btn",onClick:()=>c(e=>!e),children:(0,s.jsx)("p",{className:"text-xs text-secondary",children:"Show less"})})})]})},v=e=>{let{payload:t}=e;return(0,s.jsx)("div",{className:"w-full flex overflow-x-scroll justify-start max-h-[50vh] p-4 items-start gap-3",children:t.map((e,t)=>(0,s.jsxs)("div",{className:"p-8 bg-foreground shadow-xl rounded-lg w-[50vw] flex-shrink-0 flex flex-col gap-2",children:[(0,s.jsx)("p",{className:"text-sm font-medium",children:e.title}),(0,s.jsx)("p",{className:"text-xs text-secondary",children:e.subtitle}),(0,s.jsx)(g,{_text:e.content})]},"".concat(e.uuid,"-").concat(t)))})},N=a(68009),b=a(49089),_=a(62869),w=a(87374),S=a(43257),k=a(81103),Z=e=>{let{conversationID:t,queryID:a,messages:c,query_start:o,query_end:i,feedback:r,updateFeedback:d}=e,[x,u]=(0,l.useState)(""),[p,m]=(0,l.useState)(!1),[f,h]=(0,l.useState)(!1),[y,j]=(0,l.useState)(!1),{showFeedbackNotification:g,disableFeedbackNotification:v}=(0,l.useContext)(w.F),[N,Z]=(0,l.useState)(!0);return(0,l.useEffect)(()=>{m(1===r),h(0===r),j(2===r)},[r]),(0,l.useEffect)(()=>{if(c.length>0){let e="";c.forEach(t=>{"error"===t.type||"warning"===t.type?e+=t.payload.text:"text"===t.type&&(e+=t.payload.objects[0].text)}),u(e)}},[c]),(0,l.useEffect)(()=>{if(g){let e=setTimeout(()=>{Z(!1)},4e3),t=setTimeout(()=>{v()},7e3);return()=>{clearTimeout(e),clearTimeout(t)}}},[g,v]),(0,s.jsxs)("div",{className:"w-full flex justify-end items-center relative gap-2",children:[g&&(0,s.jsxs)("div",{className:"flex absolute bottom-full transition-opacity duration-300 gap-2 right-0 mb-2 bg-foreground backdrop-blur-sm rounded-lg p-3 ".concat(N?"fade-in":"fade-out"),children:[(0,s.jsx)(S.rNr,{size:16,className:"text-primary"}),(0,s.jsx)("p",{className:"text-sm text-primary",children:"Rate this response and help Elysia improve!"})]}),(0,s.jsxs)("p",{className:"text-sm text-secondary",children:["Finished in"," ",i?i.getTime()-o.getTime()>6e4?"".concat(Math.round((i.getTime()-o.getTime())/6e4),"m"):"".concat(Math.round((i.getTime()-o.getTime())/1e3),"s"):"0s"]}),(0,s.jsxs)("div",{className:"flex ",children:[(0,s.jsx)(n.Z,{copyText:x}),(0,s.jsxs)(k.pn,{children:[(0,s.jsxs)(k.u,{children:[(0,s.jsx)(k.aJ,{asChild:!0,children:(0,s.jsx)(_.z,{size:"icon",className:"bg-background ".concat(y?"text-highlight":""),onClick:()=>{d(t,a,2)},children:(0,s.jsx)(b.$0H,{size:16})})}),(0,s.jsx)(k._v,{children:(0,s.jsx)("p",{children:"Very Good Response"})})]}),(0,s.jsxs)(k.u,{children:[(0,s.jsx)(k.aJ,{asChild:!0,children:(0,s.jsx)(_.z,{size:"icon",className:"bg-background ".concat(p?"text-accent":""),onClick:()=>{d(t,a,1)},children:(0,s.jsx)(b.spm,{size:12})})}),(0,s.jsx)(k._v,{children:(0,s.jsx)("p",{children:"Good Response"})})]}),(0,s.jsxs)(k.u,{children:[(0,s.jsx)(k.aJ,{asChild:!0,children:(0,s.jsx)(_.z,{size:"icon",className:"bg-background ".concat(f?"text-error":""),onClick:()=>{d(t,a,0)},children:(0,s.jsx)(b.bGJ,{size:12})})}),(0,s.jsx)(k._v,{children:(0,s.jsx)("p",{children:"Bad Response"})})]})]})]})]})},C=a(84154),z=e=>{let{info:t}=e;return(0,s.jsx)("div",{className:"w-full flex flex-col justify-start items-start ",children:(0,s.jsx)("div",{className:"max-w-3/5",children:(0,s.jsxs)("div",{className:"flex flex-col justify-start items-start gap-2 chat-animation border border-secondary p-4 rounded-lg",children:[(0,s.jsxs)("div",{className:"flex gap-2 items-center",children:[(0,s.jsx)(C.zKx,{className:"text-primary text-lg"}),(0,s.jsx)("p",{className:"text-primary text-sm font-bold",children:"Info"})]}),(0,s.jsx)(o.Z,{text:t})]})})})},E=a(93022),T=a(5746),O=a(42057),P=a(10193),R=e=>{let{payload:t}=e;return(0,s.jsx)("div",{className:"w-full flex flex-col justify-start items-start ",children:(0,s.jsx)("div",{className:"max-w-3/5",children:(0,s.jsxs)("div",{className:"flex flex-col justify-start items-start gap-2 chat-animation border border-secondary p-4 rounded-lg",children:[(0,s.jsxs)("div",{className:"flex gap-2 items-center",children:[(0,s.jsx)(i.SZZ,{className:"text-primary text-lg"}),(0,s.jsx)("p",{className:"text-primary text-sm font-bold",children:"Rate Limit reached"})]}),(0,s.jsx)(o.Z,{text:t.text+"\n ("+t.time_left.hours+"h "+t.time_left.minutes+"m "+t.time_left.seconds+"s)"})]})})})},q=a(22744),F=a(94295),J=a(6512),I=e=>{let{payload:t,handleSendQuery:a}=e,[n,c]=(0,l.useState)(null);return(0,s.jsxs)("div",{className:"w-full flex flex-col items-start justify-start gap-3 fade-in",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)(q.IwI,{className:"text-lg"}),(0,s.jsx)("p",{className:"text-lg",children:"Related Questions"})]}),(0,s.jsx)(J.Z,{}),(0,s.jsx)("div",{className:"w-full flex flex-col items-start justify-start gap-3",children:t.suggestions.map(e=>(0,s.jsxs)("div",{onClick:()=>{c(e),a(e,"",!1)},className:"rounded-lg flex flex-col gap-3 w-full cursor-pointer transition-all duration-300 \n            ".concat(n===e?"text-primary":"text-secondary hover:text-primary"),children:[(0,s.jsxs)("div",{className:"flex w-full justify-between items-center gap-2",children:[(0,s.jsx)("p",{className:"text-sm",children:e}),(0,s.jsx)(F.D0w,{})]}),(0,s.jsx)(J.Z,{})]},e))})]})},L=e=>{let{messages:t,_collapsed:a,messagesEndRef:n,conversationID:o,queryID:i,finished:f,query_start:g,query_end:b,NER:_,updateNER:w,feedback:S,updateFeedback:k,addDisplacement:C,addDistortion:q,handleSendQuery:F,isLastQuery:J}=e,[L,D]=(0,l.useState)([]),[Q,Y]=(0,l.useState)(a),{socketOnline:U}=(0,l.useContext)(P.J),V=e=>e.filter(e=>"training_update"!==e.type),W=e=>{let t=[],a=new Set;return e.forEach((s,l)=>{if(!a.has(l)){if("result"===s.type&&"document"===s.payload.type){let n={type:"merged_document",code_metadata:[],objects:[]};for(let t=l;t<e.length;t++){if(a.has(t))continue;let s=e[t];if("result"===s.type&&"document"===s.payload.type){let e={metadata:{collection_name:s.payload.metadata.collection_name,total_objects:s.payload.objects.length},code:s.payload.code};n.code_metadata.push(e),n.objects.push(...s.payload.objects),a.add(t)}}t.push({...s,type:"merged_result",payload:n,id:s.id})}else t.push(s)}}),t},G=e=>{let t=[],a=new Set;return e.forEach((s,l)=>{if(!a.has(l)){if("result"===s.type&&"conversation"===s.payload.type){let n={type:"merged_conversation",code_metadata:[],objects:[]};for(let t=l;t<e.length;t++){if(a.has(t))continue;let s=e[t];if("result"===s.type&&"conversation"===s.payload.type){let e={metadata:{collection_name:s.payload.metadata.collection_name,total_objects:s.payload.objects.length},code:s.payload.code};n.code_metadata.push(e),n.objects.push(...s.payload.objects),a.add(t)}}t.push({...s,type:"merged_result",payload:n,id:s.id})}else t.push(s)}}),t},B=e=>{let t=[],a=[];return e.forEach((s,l)=>{if(!a.includes(l)){if("text"===s.type&&"response"===s.payload.type&&l+1!=e.length){let n=[s.payload.objects[0]],c=s.id;for(let t=l+1;t<e.length;t++)if("text"===e[t].type&&"response"===e[t].payload.type)n.push(e[t].payload.objects[0]),a.push(t);else break;let o={type:"response",metadata:s.payload.metadata,objects:n},i={...s,payload:o,id:c};t.push(i)}else t.push(s)}}),t};return(0,l.useEffect)(()=>{D(B(G(W(V(t))))),C(.1),q(.08)},[t]),(0,s.jsx)("div",{className:"flex justify-start items-start w-full p-4 transition-all  duration-300",children:(0,s.jsxs)("div",{className:"flex flex-col gap-4 w-full relative z-10 rounded-lg",children:[L.filter(e=>"User"===e.type).map((e,t)=>(0,s.jsx)("div",{className:"w-full flex",children:"User"===e.type&&(0,s.jsx)(c,{NER:_,updateNER:w,conversationId:o,queryId:i,onClick:()=>Y(e=>!e),payload:e.payload.objects,collapsed:Q},"".concat(t,"-").concat(e.id,"-user"))},"".concat(t,"-").concat(e.id,"-message"))),!Q&&L.length<2&&U&&!f&&(0,s.jsxs)("div",{className:"w-full flex-col flex gap-2 justify-start items-start fade-in",children:[(0,s.jsx)(E.O,{className:"w-full h-[1rem]"}),(0,s.jsx)(E.O,{className:"w-1/2 h-[1rem]"}),(0,s.jsx)(E.O,{className:"w-2/5 h-[1rem]"}),(0,s.jsx)(E.O,{className:"w-2/5 h-[1rem]"})]}),!Q&&(0,s.jsxs)("div",{className:"flex flex-col gap-4",children:[(0,s.jsx)("div",{className:"flex flex-col gap-5",children:L.filter(e=>"User"!==e.type&&"suggestion"!==e.type).map((e,t)=>(0,s.jsxs)("div",{className:"w-full flex",children:["result"===e.type&&(0,s.jsxs)("div",{className:"w-full flex flex-col justify-start items-start gap-3",children:[(0,s.jsx)("div",{className:"flex",children:e.payload.code&&(0,s.jsx)(y.Z,{payload:e.payload.code,metadata:{collection_name:e.payload.metadata.collection_name,total_objects:e.payload.objects.length}})}),"ticket"===e.payload.type&&(0,s.jsx)(x.Z,{message:e},"".concat(t,"-").concat(e.id,"-tickets")),"ecommerce"===e.payload.type&&(0,s.jsx)(m.Z,{payload:e.payload},"".concat(t,"-").concat(e.id,"-ecommerce")),"conversation"===e.payload.type&&(0,s.jsx)(T.Z,{payload:e.payload.objects},"".concat(t,"-").concat(e.id,"-conversations")),"message"===e.payload.type&&(0,s.jsx)(O.Z,{payload:e.payload.objects},"".concat(t,"-").concat(e.id,"-conversations")),("boring_generic"===e.payload.type||"mapped"===e.payload.type)&&(0,s.jsx)(h,{payload:e.payload.objects},"".concat(t,"-").concat(e.id,"-boring_generic")),"epic_generic"===e.payload.type&&(0,s.jsx)(v,{payload:e.payload.objects},"".concat(t,"-").concat(e.id,"-epic_generic")),"aggregation"===e.payload.type&&(0,s.jsx)(j.Z,{aggregation:e.payload.objects},"".concat(t,"-").concat(e.id,"-aggregation")),"document"===e.payload.type&&(0,s.jsx)(N.Z,{payload:e.payload.objects},"".concat(t,"-").concat(e.id,"-document"))]}),"merged_result"===e.type&&(0,s.jsxs)("div",{className:"w-full flex flex-col justify-start items-start gap-3",children:[(0,s.jsx)("div",{className:"flex flex-wrap",children:e.payload.code_metadata&&e.payload.code_metadata.map((t,a)=>(0,s.jsx)(y.Z,{payload:t.code,metadata:t.metadata},"".concat(a,"-").concat(e.id,"-code-").concat(a)))}),"merged_document"===e.payload.type&&(0,s.jsx)(N.Z,{payload:e.payload.objects},"".concat(t,"-").concat(e.id,"-document")),"merged_conversation"===e.payload.type&&(0,s.jsx)(T.Z,{payload:e.payload.objects},"".concat(t,"-").concat(e.id,"-conversation"))]}),"text"===e.type&&(0,s.jsxs)("div",{className:"w-full flex flex-col justify-start items-start ",children:["response"===e.payload.type&&(0,s.jsx)(d,{payload:e.payload.objects},"".concat(t,"-").concat(e.id,"-response")),"summary"===e.payload.type&&(0,s.jsx)(p,{payload:e.payload.objects},"".concat(t,"-").concat(e.id,"-summary"))]}),["error","authentication_error"].includes(e.type)&&(0,s.jsx)(r,{error:e.payload.text},"".concat(t,"-").concat(e.id,"-error")),["tree_timeout_error"].includes(e.type)&&(0,s.jsx)(z,{info:e.payload.text},"".concat(t,"-").concat(e.id,"-info")),["rate_limit_error"].includes(e.type)&&(0,s.jsx)(R,{payload:e.payload},"".concat(t,"-").concat(e.id,"-info")),"warning"===e.type&&(0,s.jsx)(u,{warning:e.payload.text},"".concat(t,"-").concat(e.id,"-warning"))]},"".concat(t,"-").concat(e.id,"-message")))}),f&&(0,s.jsx)(Z,{conversationID:o,queryID:i,messages:t,query_start:g,query_end:b,feedback:S,updateFeedback:k}),L.filter(e=>"suggestion"===e.type).map((e,t)=>(0,s.jsx)("div",{className:"w-full flex",children:"suggestion"===e.type&&J&&(0,s.jsx)(I,{payload:e.payload,handleSendQuery:F},"".concat(t,"-").concat(e.id,"-suggestion"))},"".concat(t,"-").concat(e.id,"-message")))]}),!Q&&(0,s.jsx)("div",{ref:n}),!U&&(0,s.jsx)("div",{className:"w-full flex justify-center items-center",children:(0,s.jsx)("p",{className:"text-primary text-sm shine",children:"Connection lost. Reconnecting..."})})]})})}},87374:function(e,t,a){a.d(t,{EvaluationProvider:function(){return o},F:function(){return c}});var s=a(57437),l=a(2265),n=a(99376);let c=(0,l.createContext)({evalPage:null,changeEvalPage:()=>{},showFeedbackNotification:!0,disableFeedbackNotification:()=>{}}),o=e=>{let{children:t}=e,a=(0,n.useSearchParams)(),o=(0,n.useRouter)(),i=(0,n.usePathname)(),[r,d]=(0,l.useState)(null),[x,u]=(0,l.useState)(!0);return(0,l.useEffect)(()=>{"/eval"===i?d(null):"/eval/feedback"===i&&d("feedback")},[a,i]),(0,s.jsx)(c.Provider,{value:{evalPage:r,changeEvalPage:e=>{null===e?o.push("/eval"):o.push("/eval/".concat(e))},showFeedbackNotification:x,disableFeedbackNotification:()=>{u(!1)}},children:t})}},10193:function(e,t,a){a.d(t,{J:function(){return i},SocketProvider:function(){return r}});var s=a(57437),l=a(2265),n=a(65023),c=a(56512),o=a(56654);let i=(0,l.createContext)({socketOnline:!1,sendQuery:async()=>!1}),r=e=>{let{children:t}=e,{addMessageToConversation:a,setConversationStatus:r,setAllConversationStatuses:d,updateTree:x,finishQuery:u,handleConversationError:p,handleAllConversationsError:m,addSuggestionToConversation:f}=(0,l.useContext)(c.L),{enableRateLimitDialog:h,getUserLimit:y}=(0,l.useContext)(o.B),[j,g]=(0,l.useState)(!1),[v,N]=(0,l.useState)(),[b,_]=(0,l.useState)(!1);(0,l.useEffect)(()=>{_(!0)},[]),(0,l.useEffect)(()=>{let e=setInterval(()=>{j&&(null==v?void 0:v.readyState)!==WebSocket.CLOSED&&v||(console.log("Socket not online, reconnecting..."),_(e=>!e))},5e3);return()=>clearInterval(e)},[j,v]),(0,l.useEffect)(()=>{let e=new WebSocket((0,n.Zq)());return e.onopen=()=>{g(!0)},e.onmessage=e=>{try{let t=JSON.parse(e.data);if("status"===t.type){let e=t.payload;r(e.text,t.conversation_id)}else"completed"===t.type?(y(),r("",t.conversation_id),u(t.conversation_id,t.query_id),f(t.conversation_id,t.query_id,t.user_id)):"tree_update"===t.type?x(t):(["error","tree_timeout_error","rate_limit_error","authentication_error"].includes(t.type)&&(p(t.conversation_id),u(t.conversation_id,t.query_id),r("",t.conversation_id)),"rate_limit_error"===t.type&&h(),a([t],t.conversation_id,t.query_id))}catch(e){}},e.onerror=e=>{g(!1),d(""),m()},e.onclose=()=>{g(!1),d(""),m()},N(e),()=>{e.readyState!==WebSocket.CLOSED&&e.close()}},[b]);let w=async(e,t,a,s,l,n,c)=>(r("Thinking...",a),null==v||v.send(JSON.stringify({user_id:e,query:t,conversation_id:a,query_id:s,route:l,mimick:n,auth:c,auth_key:""})),Promise.resolve(!0));return(0,s.jsx)(i.Provider,{value:{socketOnline:j,sendQuery:w},children:t})}},85024:function(e,t,a){var s=a(57437),l=a(2265),n=a(62869),c=a(32768),o=a(22744);t.Z=e=>{let{copyText:t}=e,[a,i]=(0,l.useState)(!1);return(0,l.useEffect)(()=>{a&&setTimeout(()=>i(!1),2e3)},[a]),(0,s.jsx)(n.z,{onClick:e=>{e.stopPropagation(),navigator.clipboard.writeText(t),i(!0)},variant:"ghost",size:"icon",className:"".concat(a?"text-accent":"text-secondary"),title:"Copy to clipboard",children:a?(0,s.jsx)(c.vYr,{size:14}):(0,s.jsx)(o.Fqs,{size:14})})}},81103:function(e,t,a){a.d(t,{_v:function(){return d},aJ:function(){return r},pn:function(){return o},u:function(){return i}});var s=a(57437),l=a(2265),n=a(56561),c=a(94508);let o=n.zt,i=n.fC,r=n.xz,d=l.forwardRef((e,t)=>{let{className:a,sideOffset:l=4,...o}=e;return(0,s.jsx)(n.h_,{children:(0,s.jsx)(n.VY,{ref:t,sideOffset:l,className:(0,c.cn)("z-50 overflow-hidden rounded-md bg-background_alt px-3 py-1.5 text-xs text-primary animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",a),...o})})});d.displayName=n.VY.displayName}}]);